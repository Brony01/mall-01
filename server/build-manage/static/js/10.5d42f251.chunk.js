(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[10],{1294:function(e,t,a){"use strict";a.r(t);var s=a(0),i=a.n(s),r=a(23),l=(a(254),a(177)),n=(a(255),a(178)),o=(a(107),a(46)),c=(a(58),a(20)),d=(a(92),a(24)),p=(a(712),a(763)),m=(a(256),a(97)),u=a(50),h=a(170);const{Option:g}=m.a,{Text:y}=p.a,E={marginLeft:"0.5rem"};class f extends s.Component{constructor(){super(),this.state={pageNum:1,selectValue:"1",productListSource:[],total:0,btnLoading:!1,loading:!1,searchText:""},this.up_down=async e=>{this.setState({loading:!0});const t={productId:e._id};t.status=e.status?0:1;0===(await Object(u.o)(t)).status&&(this.setState({loading:!1}),d.a.success("\u66f4\u65b0\u6210\u529f\uff01"),this.getProductList(this.pageNum))},this.productUpdate=async e=>{this.props.history.push("/product/add",e)},this.productDelete=async e=>{0===(await Object(u.i)({_id:e._id})).status&&this.getProductList(1)},this.productDetail=e=>{this.props.history.push({pathname:"/product/detail",state:e})},this.selectHandleChange=e=>{this.setState({selectValue:e,inputPlaceholder:"1"===e?"\u8bf7\u8f93\u5165\u540d\u79f0":"\u8bf7\u8f93\u5165\u63cf\u8ff0",inputValue:""})},this.addProductBtn=e=>{e.stopPropagation(),this.props.history.push("/product/add")},this.getProductList=async e=>{let t;this.pageNum=e,this.setState({tableLoading:!0}),t=await Object(u.n)({pageNum:e,pageSize:5});const{total:a,list:s}=t.data;0===t.status&&s.length>0&&(s.forEach(e=>{e.price=Object(h.a)(e.price)}),this.setState({total:a,productListSource:s,tableLoading:!1,btnLoading:!1}))},this.filterData=()=>{const{productListSource:e,searchText:t,selectValue:a}=this.state;return t?"1"===a?e.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())):e.filter(e=>e.desc.toLowerCase().includes(t.toLowerCase())):e};const{loading:e}=this.state;this.columns=[{title:"\u5546\u54c1\u540d\u79f0",dataIndex:"name"},{title:"\u4ef7\u683c",dataIndex:"price",render:e=>"\uffe5".concat(e)},{title:"\u5546\u54c1\u63cf\u8ff0",dataIndex:"desc"},{title:"\u5546\u54c1\u56fe\u7247",dataIndex:"imgs",render:e=>i.a.createElement("img",{src:e[0],alt:"\u5546\u54c1\u56fe\u7247",style:{width:50}})},{title:"\u72b6\u6001",render:t=>i.a.createElement("span",null,i.a.createElement(y,{type:t.status?"success":"danger"},t.status?"\u4e0a\u67b6":"\u4e0b\u67b6"),i.a.createElement(c.a,{size:"small",style:E,loading:e,onClick:()=>this.up_down(t),type:"primary"},t.status?"\u4e0b\u67b6":"\u4e0a\u67b6"))},{title:"\u64cd\u4f5c",render:e=>i.a.createElement("span",null,i.a.createElement(c.a,{type:"link",onClick:()=>this.productDetail(e)},"\u8be6\u60c5"),i.a.createElement(c.a,{type:"link",onClick:()=>this.productUpdate(e)},"\u4fee\u6539"),i.a.createElement(c.a,{type:"link",loading:this.state.btnLoading,onClick:()=>this.productDelete(e)},"\u5220\u9664"))}]}componentDidMount(){this.getProductList(1)}render(){const{loading:e}=this.state,t=this.filterData();return i.a.createElement(l.a,{title:(()=>i.a.createElement("div",null,i.a.createElement(m.a,{defaultValue:"1",style:{width:"7rem"},onChange:this.selectHandleChange},i.a.createElement(g,{value:"1"},"\u6309\u540d\u79f0\u641c\u7d22"),i.a.createElement(g,{value:"2"},"\u6309\u63cf\u8ff0\u641c\u7d22")),i.a.createElement(o.a.Search,{placeholder:"\u641c\u7d22\u5546\u54c1",onSearch:e=>this.setState({searchText:e}),style:{width:200}})))(),extra:(()=>i.a.createElement("span",null,i.a.createElement(c.a,{icon:"plus",type:"primary",onClick:this.addProductBtn},"\u6dfb\u52a0\u5546\u54c1")))()},i.a.createElement(n.a,{dataSource:t,columns:this.columns,bordered:!0,loading:e,rowKey:"_id",size:"small",pagination:{defaultCurrent:1,pageSize:3,total:t.length}}))}}var C=Object(r.g)(f),x=(a(1290),a(1288)),b=(a(887),a(1289)),S=(a(108),a(28)),k=(a(109),a(4)),v=a(713),L=a(978),I=a(979),w=a.n(I),T=a(980),D=a.n(T);a(981);class O extends s.Component{constructor(e){super(e),this.state={editorState:v.EditorState.createEmpty()},this.onEditorStateChange=e=>{this.setState({editorState:e})},this.getInputData=()=>{const{editorState:e}=this.state;return w()(Object(v.convertToRaw)(e.getCurrentContent()))},this.uploadImageCallBack=e=>new Promise((t,a)=>{const s=new XMLHttpRequest;s.open("POST","/manage/img/upload");const i=new FormData;i.append("image",e),s.send(i),s.addEventListener("load",()=>{const e=JSON.parse(s.responseText),{status:a,data:i}=e;0===a&&t({data:{link:i.url}})}),s.addEventListener("error",()=>{const e=JSON.parse(s.responseText);a(e)})});const t=this.props.preDetail;if(!t)return;const a=D()(t);if(a){const e=v.ContentState.createFromBlockArray(a.contentBlocks),t=v.EditorState.createWithContent(e);this.state={editorState:t}}}render(){const{editorState:e}=this.state;return i.a.createElement("div",null,i.a.createElement(L.Editor,{editorState:e,editorStyle:{border:"1px solid rgba(0, 0, 0, 0.65)",minHeight:"100px",lineHeight:"0.1rem",textIndent:"2rem"},onEditorStateChange:this.onEditorStateChange,toolbar:{image:{uploadCallback:this.uploadImageCallBack,alt:{present:!0,mandatory:!0}}}}))}}var P=a(45),V=a.n(P);const{TextArea:R}=o.a;class j extends s.Component{constructor(e){super(e),this.state={loading:!1,productClassList:[],cardTitle:"\u6dfb\u52a0\u5546\u54c1"},this.handleSubmit=e=>{e.preventDefault();const t=this.richEditTextRef.current.getInputData();this.props.form.validateFields(async(e,a)=>{if(!e){this.setState({loading:!0});const e={categoryId:a.prdCategory[1]?a.prdCategory[1]:a.prdCategory[0],pCategoryId:a.prdCategory[0],name:a.prdName,price:a.prdPrice,desc:a.prdDesc,status:1,detail:t,imgs:a.imgs.split(","),seckillPrice:a.seckillPrice,seckillStock:a.seckillStock,seckillStart:a.seckillTime&&a.seckillTime.length>0?a.seckillTime[0].toDate():null,seckillEnd:a.seckillTime&&a.seckillTime.length>1?a.seckillTime[1].toDate():null};0===(await(this.isUpdate?Object(u.p)({...e,_id:this.oldData._id}):Object(u.b)(e))).status&&(this.setState({loading:!1}),d.a.success("\u6dfb\u52a0\u6210\u529f\uff01"),this.props.location.state=null,this.props.form.resetFields())}})},this.getProductClass=async e=>{const{data:t}=await Object(u.g)({parentId:e});if("0"!==e)return t;this.initSelectOptions(t)},this.productLoadData=async e=>{const t=e[e.length-1];t.loading=!0;const a=t.value,s=await this.getProductClass(a);if(t.loading=!1,s&&s.length>0){const e=s.map(e=>({value:e._id,label:e.name,isLeaf:!0}));t.children=e}else t.isLeaf=!0;this.setState({productClassList:[...this.state.productClassList]})},this.initSelectOptions=async e=>{const t=e.map(e=>({value:e._id,label:e.name,isLeaf:!1})),{categoryId:a,pCategoryId:s}=this.oldData;if(a){const e=(await this.getProductClass(s)).map(e=>({value:e._id,label:e.name,isLeaf:!1}));t.find(e=>e.value===s).children=e}this.setState({productClassList:t})},this.priceValidator=(e,t,a)=>{if(1*t>=0)return a();a("\u4ef7\u683c\u5e94\u5927\u4e8e0")},this.myRef=i.a.createRef(),this.richEditTextRef=i.a.createRef();const{state:t}=this.props.location;this.title=i.a.createElement("span",null,i.a.createElement(k.a,{type:"arrow-left",onClick:()=>{this.props.history.goBack()},style:{fontSize:20,marginRight:4}}),t?"\u4fee\u6539\u5546\u54c1":"\u6dfb\u52a0\u5546\u54c1")}componentDidMount(){this.getProductClass("0")}render(){let e=[];const t=this.props.location.state||{};this.oldData=t;const{categoryId:a,pCategoryId:s,detail:r}=t;this.isUpdate=!!s,a?e.push(s,a):s&&e.push(s);const{productClassList:n,loading:d}=this.state,{getFieldDecorator:p}=this.props.form;return i.a.createElement(l.a,{title:this.title},i.a.createElement(S.a,Object.assign({},{labelCol:{xs:{span:24},sm:{span:2}},wrapperCol:{xs:{span:24},sm:{span:18}}},{onSubmit:this.handleSubmit}),i.a.createElement(S.a.Item,{label:"\u5546\u54c1\u540d\u79f0"},p("prdName",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u540d\u79f0!"}],initialValue:t.name})(i.a.createElement(o.a,{placeholder:"\u5546\u54c1\u540d\u79f0"}))),i.a.createElement(S.a.Item,{label:"\u5546\u54c1\u63cf\u8ff0"},p("prdDesc",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u63cf\u8ff0!"}],initialValue:t.desc})(i.a.createElement(R,{placeholder:"\u5546\u54c1\u63cf\u8ff0",autosize:!0}))),i.a.createElement(S.a.Item,{label:"\u5546\u54c1\u4ef7\u683c"},p("prdPrice",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4ef7\u683c\uff01"},{validator:this.priceValidator}],initialValue:t.price})(i.a.createElement(o.a,{prefix:"\uffe5",placeholder:"\u5546\u54c1\u4ef7\u683c",suffix:"\u5143"}))),i.a.createElement(S.a.Item,{label:"\u5546\u54c1\u5206\u7c7b"},p("prdCategory",{initialValue:e,rules:[{type:"array",required:!0,message:"\u8bf7\u8f93\u5165\u9009\u62e9\u5206\u7c7b!"}]})(i.a.createElement(b.a,{placeholder:"\u8bf7\u9009\u62e9\u5546\u54c1\u5206\u7c7b",options:n,loadData:this.productLoadData}))),i.a.createElement(S.a.Item,{label:"\u5546\u54c1\u56fe\u7247URL"},p("imgs",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5546\u54c1\u56fe\u7247URL!"}],initialValue:t.imgs?t.imgs.join(","):""})(i.a.createElement(o.a,{placeholder:"\u5546\u54c1\u56fe\u7247URL\uff08\u591a\u4e2a\u7528\u9017\u53f7\u9694\u5f00\uff09"}))),i.a.createElement(S.a.Item,{label:"\u79d2\u6740\u4ef7\u683c"},p("seckillPrice",{rules:[{required:!1}],initialValue:t.seckillPrice})(i.a.createElement(o.a,{prefix:"\uffe5",placeholder:"\u79d2\u6740\u4ef7\u683c",suffix:"\u5143"}))),i.a.createElement(S.a.Item,{label:"\u79d2\u6740\u5e93\u5b58"},p("seckillStock",{rules:[{required:!1}],initialValue:t.seckillStock})(i.a.createElement(o.a,{placeholder:"\u79d2\u6740\u5e93\u5b58"}))),i.a.createElement(S.a.Item,{label:"\u79d2\u6740\u65f6\u95f4"},p("seckillTime",{rules:[{required:!1}],initialValue:t.seckillStart&&t.seckillEnd?[V()(t.seckillStart),V()(t.seckillEnd)]:[]})(i.a.createElement(x.a.RangePicker,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss"}))),i.a.createElement(S.a.Item,{label:"\u5546\u54c1\u8be6\u60c5"},i.a.createElement(O,{preDetail:r,ref:this.richEditTextRef})),i.a.createElement(S.a.Item,{wrapperCol:{sm:{span:10,offset:10}}},i.a.createElement(c.a,{type:"primary",htmlType:"submit",loading:d},"\u589e\u52a0"))))}}var B=S.a.create({name:"normal_login"})(Object(r.g)(j)),_=(a(258),a(128)),q=(a(790),a(878)),z=a(984),F=a.n(z),M=a(791);const{Text:N}=p.a,U={fontSize:15,marginRight:"1rem"};class A extends s.Component{constructor(){super(),this.state={chartType:"bar"},this.handleChartTypeChange=e=>{this.setState({chartType:e.target.value})},this.goBack=e=>{this.props.history.goBack()},this.getOption=()=>{const e=this.props.location.state,{chartType:t}=this.state,a={title:{text:"\u4ea7\u54c1\u6570\u636e"},tooltip:{position:"right"},legend:{data:["\u8bbf\u95ee\u91cf","\u6536\u85cf\u91cf","\u6210\u4ea4\u91cf"],right:0,bottom:0}};return"bar"===t?{...a,xAxis:{data:["\u8bbf\u95ee\u91cf","\u6536\u85cf\u91cf","\u6210\u4ea4\u91cf"]},yAxis:{},series:[{name:"\u6570\u91cf",type:"bar",data:[e.visitCount,e.favoriteCount,e.orderCount]}],color:["#ff7f50","#87cefa","#ece05a"]}:"pie"===t?{...a,series:[{name:"\u6570\u91cf",type:"pie",data:[{value:e.visitCount,name:"\u8bbf\u95ee\u91cf"},{value:e.favoriteCount,name:"\u6536\u85cf\u91cf"},{value:e.orderCount,name:"\u6210\u4ea4\u91cf"}]}],color:["#ff7f50","#87cefa","#8a75ff"]}:"conversionFavorite"===t?this.getConversionOption(e.visitCount,e.favoriteCount,"\u8bbf\u95ee\u91cf","\u6536\u85cf\u91cf"):"conversionOrder"===t?this.getConversionOption(e.visitCount,e.orderCount,"\u8bbf\u95ee\u91cf","\u6210\u4ea4\u91cf"):void 0},this.getConversionOption=(e,t,a,s)=>{const i=(t/e*100).toFixed(2),r=15*Math.sqrt(e),l=15*Math.sqrt(t);return{title:{text:"".concat(a,"\u8f6c\u5316\u4e3a").concat(s),left:"center"},series:[{type:"custom",renderItem:(a,s)=>{const n=s.coord([0,.5]),o=s.coord([1,.5]),c=[{type:"circle",shape:{cx:n[0],cy:n[1],r:r},style:{fill:"#ff7f50"},textContent:{style:{text:"".concat(e),fontSize:14,fill:"#5e3636"}},textConfig:{position:"inside",insideColor:"#000"}},{type:"circle",shape:{cx:o[0],cy:o[1],r:l},style:{fill:"#87cefa"},textContent:{style:{text:"".concat(t),fontSize:14,fill:"#fff"}},textConfig:{position:"inside",insideColor:"#000"}}],d=[{type:"text",style:{text:"\u8f6c\u5316\u7387: ".concat(i,"%"),x:(n[0]+o[0])/2,y:n[1]-30,textAlign:"center",font:"bold 18px sans-serif"}}],p={type:"group",children:c};return{type:"group",children:[{type:"line",shape:{x1:n[0],y1:n[1],x2:o[0],y2:o[1]},style:{stroke:"#6db1f5",lineWidth:10},silent:!0},p,...d]}},data:[0]}],xAxis:{show:!1,min:0,max:1},yAxis:{show:!1,min:0,max:1},grid:{left:"20%",right:"30%",top:"20%",bottom:"20%"}}},this.title=i.a.createElement(k.a,{type:"arrow-left",onClick:this.goBack,style:{fontSize:20}})}render(){const e=this.props.location.state,t=["\u5546\u54c1\u540d\u79f0","\u5546\u54c1\u63cf\u8ff0","\u5546\u54c1\u4ef7\u683c","\u5546\u54c1\u8be6\u60c5"];return i.a.createElement(l.a,{title:this.title},i.a.createElement("img",{src:e.imgs[0],alt:e.name,style:{width:"100%",marginBottom:"1rem"}}),i.a.createElement(q.a,{header:i.a.createElement("div",null,"\u5546\u54c1\u8be6\u60c5"),bordered:!0},i.a.createElement(q.a.Item,null,i.a.createElement(N,{style:U},t[0],":"),e.name),i.a.createElement(q.a.Item,null,i.a.createElement(N,{style:U},t[1],":"),e.desc),i.a.createElement(q.a.Item,null,i.a.createElement(N,{style:U},t[2],":"),e.price),i.a.createElement(q.a.Item,null,i.a.createElement(N,{style:U},t[3],":"),e.detail)),i.a.createElement(_.a.Group,{defaultValue:"bar",onChange:this.handleChartTypeChange,style:{marginTop:20,marginBottom:20}},i.a.createElement(_.a,{value:"bar"},"\u67f1\u72b6\u56fe"),i.a.createElement(_.a,{value:"pie"},"\u997c\u56fe"),i.a.createElement(_.a,{value:"conversionFavorite"},"\u8f6c\u5316\u7387\uff08\u8bbf\u95ee\u91cf\u5230\u6536\u85cf\u91cf\uff09"),i.a.createElement(_.a,{value:"conversionOrder"},"\u8f6c\u5316\u7387\uff08\u8bbf\u95ee\u91cf\u5230\u6210\u4ea4\u91cf\uff09")),i.a.createElement(F.a,{echarts:M,option:this.getOption(),notMerge:!0,lazyUpdate:!0,style:{height:"400px"}}))}}var H=Object(r.g)(A);t.default=class extends s.Component{constructor(){super(...arguments),this.state={}}render(){return i.a.createElement(r.d,null,i.a.createElement(r.b,{exact:!0,path:"/product",component:C}),i.a.createElement(r.b,{path:"/product/add",component:B}),i.a.createElement(r.b,{path:"/product/detail",component:H}),i.a.createElement(r.a,{to:"/product"}))}}}}]);