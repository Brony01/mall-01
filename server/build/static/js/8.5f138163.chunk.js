(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[8],{672:function(t,e,a){"use strict";a.r(e);var s=a(0),r=a.n(s),i=a(23),n=(a(236),a(169)),l=(a(238),a(171)),o=(a(108),a(45)),c=(a(58),a(19)),d=(a(93),a(24)),p=(a(536),a(563)),u=(a(237),a(98)),h=a(50),m=a(221);const{Option:g}=u.a,{Text:E}=p.a,y={marginLeft:"0.5rem"};class C extends s.Component{constructor(){super(),this.state={pageNum:1,selectValue:"1",productListSource:[],total:0,btnLoading:!1,loading:!1,searchText:""},this.up_down=async t=>{this.setState({loading:!0});const e={productId:t._id};t.status?e.status=0:e.status=1;0===(await Object(h.l)(e)).status&&(this.setState({loading:!1}),d.a.success("\u66f4\u65b0\u6210\u529f\uff01"),this.getProductList(this.pageNum))},this.productUpdate=async t=>{this.props.history.push("/product/add",t)},this.productDelete=async t=>{0===(await Object(h.g)({_id:t._id})).status&&this.getProductList(1)},this.productDetail=t=>{this.props.history.push({pathname:"/product/detail",state:t})},this.selectHandleChange=t=>{this.setState({selectValue:t,inputPlaceholder:"1"===t?"\u8bf7\u8f93\u5165\u540d\u79f0":"\u8bf7\u8f93\u5165\u63cf\u8ff0",inputValue:""})},this.addProductBtn=t=>{t.stopPropagation(),this.props.history.push("/product/add")},this.getProductList=async t=>{let e;this.pageNum=t,this.setState({tableLoading:!0}),e=await Object(h.k)({pageNum:t,pageSize:5});const{total:a,list:s}=e.data;0===e.status&&s.length>0&&(s.forEach(t=>{t.price=Object(m.a)(t.price)}),this.setState({total:a,productListSource:s,tableLoading:!1,btnLoading:!1}))},this.filterData=()=>{const{productListSource:t,searchText:e,selectValue:a}=this.state;return e?"1"===a?t.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())):t.filter(t=>t.desc.toLowerCase().includes(e.toLowerCase())):t};const{loading:t}=this.state;this.columns=[{title:"\u5546\u54c1\u540d\u79f0",dataIndex:"name"},{title:"\u4ef7\u683c",dataIndex:"price",render:t=>"\uffe5".concat(t)},{title:"\u5546\u54c1\u63cf\u8ff0",dataIndex:"desc"},{title:"\u72b6\u6001",render:e=>r.a.createElement("span",null,r.a.createElement(E,{type:e.status?"success":"danger"},e.status?"\u663e\u793a":"\u9690\u85cf"),r.a.createElement(c.a,{size:"small",style:y,loading:t,onClick:()=>this.up_down(e),type:"primary"},e.status?"\u9690\u85cf":"\u663e\u793a"))},{title:"\u64cd\u4f5c",render:t=>r.a.createElement("span",null,r.a.createElement(c.a,{type:"link",onClick:()=>this.productDetail(t)},"\u8be6\u60c5"),r.a.createElement(c.a,{type:"link",onClick:()=>this.productUpdate(t)},"\u4fee\u6539"),r.a.createElement(c.a,{type:"link",loading:this.state.btnLoading,onClick:()=>this.productDelete(t)},"\u5220\u9664"))}]}componentDidMount(){this.getProductList(1)}render(){const{loading:t}=this.state,e=this.filterData();return r.a.createElement(n.a,{title:(()=>r.a.createElement("div",null,r.a.createElement(u.a,{defaultValue:"1",style:{width:"7rem"},onChange:this.selectHandleChange},r.a.createElement(g,{value:"1"},"\u6309\u540d\u79f0\u641c\u7d22"),r.a.createElement(g,{value:"2"},"\u6309\u63cf\u8ff0\u641c\u7d22")),r.a.createElement(o.a.Search,{placeholder:"\u641c\u7d22\u5546\u54c1",onSearch:t=>this.setState({searchText:t}),style:{width:200}})))(),extra:(()=>r.a.createElement("span",null,r.a.createElement(c.a,{icon:"plus",type:"primary",onClick:this.addProductBtn},"\u6dfb\u52a0\u5546\u54c1")))()},r.a.createElement(l.a,{dataSource:e,columns:this.columns,bordered:!0,loading:t,rowKey:"_id",size:"small",pagination:{defaultCurrent:1,pageSize:3,total:e.length}}))}}var f=Object(i.g)(C),S=(a(569),a(667)),b=(a(109),a(28)),L=(a(92),a(4)),x=a(521),w=a(660),I=a(661),k=a.n(I),D=a(662),v=a.n(D);a(663);class O extends s.Component{constructor(t){super(t),this.state={editorState:x.EditorState.createEmpty()},this.onEditorStateChange=t=>{this.setState({editorState:t})},this.getInputData=()=>{const{editorState:t}=this.state;return k()(Object(x.convertToRaw)(t.getCurrentContent()))},this.uploadImageCallBack=t=>new Promise((e,a)=>{const s=new XMLHttpRequest;s.open("POST","/manage/img/upload");const r=new FormData;r.append("image",t),s.send(r),s.addEventListener("load",()=>{const t=JSON.parse(s.responseText),{status:a,data:r}=t;0===a&&e({data:{link:r.url}})}),s.addEventListener("error",()=>{const t=JSON.parse(s.responseText);a(t)})});const e=this.props.preDetail;if(!e)return;const a=v()(e);if(a){const t=x.ContentState.createFromBlockArray(a.contentBlocks),e=x.EditorState.createWithContent(t);this.state={editorState:e}}}render(){const{editorState:t}=this.state;return r.a.createElement("div",null,r.a.createElement(w.Editor,{editorState:t,editorStyle:{border:"1px solid rgba(0, 0, 0, 0.65)",minHeight:"100px",lineHeight:"0.1rem",textIndent:"2rem"},onEditorStateChange:this.onEditorStateChange,toolbar:{image:{uploadCallback:this.uploadImageCallBack,alt:{present:!0,mandatory:!0}}}}))}}const{TextArea:P}=o.a;class T extends s.Component{constructor(t){super(t),this.state={loading:!1,productClassList:[],cardTitle:"\u6dfb\u52a0\u5546\u54c1"},this.handleSubmit=t=>{t.preventDefault();const e=this.richEditTextRef.current.getInputData();this.props.form.validateFields(async(t,a)=>{if(!t){this.setState({loading:!0});const t={categoryId:a.prdCategory[1]?a.prdCategory[1]:a.prdCategory[0],pCategoryId:a.prdCategory[0],name:a.prdName,price:a.prdPrice,desc:a.prdDesc,status:1,detail:e};0===(await(this.isUpdate?Object(h.m)({...t,_id:this.oldData._id}):Object(h.b)(t))).status&&(this.setState({loading:!1}),d.a.success("\u6dfb\u52a0\u6210\u529f\uff01"),this.props.location.state=null,this.props.form.resetFields())}})},this.getProductClass=async t=>{const{data:e}=await Object(h.e)({parentId:t});if("0"!==t)return e;this.initSelectOptions(e)},this.productLoadData=async t=>{const e=t[t.length-1];e.loading=!0;const a=e.value,s=await this.getProductClass(a);if(e.loading=!1,s&&s.length>0){const t=s.map(t=>({value:t._id,label:t.name,isLeaf:!0}));e.children=t}else e.isLeaf=!0;this.setState({productClassList:[...this.state.productClassList]})},this.initSelectOptions=async t=>{const e=t.map(t=>({value:t._id,label:t.name,isLeaf:!1})),{categoryId:a,pCategoryId:s}=this.oldData;if(a){const t=(await this.getProductClass(s)).map(t=>({value:t._id,label:t.name,isLeaf:!1}));e.find(t=>t.value===s).children=t}this.setState({productClassList:e})},this.priceValidator=(t,e,a)=>{if(1*e>=0)return a();a("\u4ef7\u683c\u5e94\u5927\u4e8e0")},this.myRef=r.a.createRef(),this.richEditTextRef=r.a.createRef();const{state:e}=this.props.location;this.title=r.a.createElement("span",null,r.a.createElement(L.a,{type:"arrow-left",onClick:()=>{this.props.history.goBack()},style:{fontSize:20,marginRight:4}}),e?"\u4fee\u6539\u5546\u54c1":"\u6dfb\u52a0\u5546\u54c1")}componentDidMount(){this.getProductClass("0")}render(){let t=[];const e=this.props.location.state||{};this.oldData=e;const{categoryId:a,pCategoryId:s,detail:i}=e;this.isUpdate=!!s,a?t.push(s,a):s&&t.push(s);const{productClassList:l,loading:d}=this.state,{getFieldDecorator:p}=this.props.form;return r.a.createElement(n.a,{title:this.title},r.a.createElement(b.a,Object.assign({},{labelCol:{xs:{span:24},sm:{span:2}},wrapperCol:{xs:{span:24},sm:{span:18}}},{onSubmit:this.handleSubmit}),r.a.createElement(b.a.Item,{label:"\u5546\u54c1\u540d\u79f0"},p("prdName",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u540d\u79f0!"}],initialValue:e.name})(r.a.createElement(o.a,{placeholder:"\u5546\u54c1\u540d\u79f0"}))),r.a.createElement(b.a.Item,{label:"\u5546\u54c1\u63cf\u8ff0"},p("prdDesc",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u63cf\u8ff0!"}],initialValue:e.desc})(r.a.createElement(P,{placeholder:"\u5546\u54c1\u63cf\u8ff0",autosize:!0}))),r.a.createElement(b.a.Item,{label:"\u5546\u54c1\u4ef7\u683c"},p("prdPrice",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4ef7\u683c\uff01"},{validator:this.priceValidator}],initialValue:e.price})(r.a.createElement(o.a,{prefix:"\uffe5",placeholder:"\u5546\u54c1\u4ef7\u683c",suffix:"\u5143"}))),r.a.createElement(b.a.Item,{label:"\u5546\u54c1\u5206\u7c7b"},p("prdCategory",{initialValue:t,rules:[{type:"array",required:!0,message:"\u8bf7\u8f93\u5165\u9009\u62e9\u5206\u7c7b!"}]})(r.a.createElement(S.a,{placeholder:"\u8bf7\u9009\u62e9\u5546\u54c1\u5206\u7c7b",options:l,loadData:this.productLoadData}))),r.a.createElement(b.a.Item,{label:"\u5546\u54c1\u8be6\u60c5"},r.a.createElement(O,{preDetail:i,ref:this.richEditTextRef})),r.a.createElement(b.a.Item,{wrapperCol:{sm:{span:10,offset:10}}},r.a.createElement(c.a,{type:"primary",htmlType:"submit",loading:d},"\u589e\u52a0"))))}}var j=b.a.create({name:"normal_login"})(Object(i.g)(T)),_=(a(665),a(668));const{Text:V}=p.a,B={fontSize:15,marginRight:"1rem"};class R extends s.Component{constructor(){super(),this.state={},this.goBack=t=>{this.props.history.goBack()},this.title=r.a.createElement(L.a,{type:"arrow-left",onClick:this.goBack,style:{fontSize:20}})}render(){const t=this.props.location.state,e=["\u5546\u54c1\u540d\u79f0","\u5546\u54c1\u63cf\u8ff0","\u5546\u54c1\u4ef7\u683c","\u5546\u54c1\u8be6\u60c5"];return r.a.createElement(n.a,{title:this.title},r.a.createElement(_.a,{header:r.a.createElement("div",null,"\u5546\u54c1\u8be6\u60c5"),bordered:!0},r.a.createElement(_.a.Item,null,r.a.createElement(V,{style:B},e[0],":"),t.name),r.a.createElement(_.a.Item,null,r.a.createElement(V,{style:B},e[1],":"),t.desc),r.a.createElement(_.a.Item,null,r.a.createElement(V,{style:B},e[2],":"),t.price),r.a.createElement(_.a.Item,null,r.a.createElement(V,{style:B},e[3],":"),t.detail)))}}var z=Object(i.g)(R);e.default=class extends s.Component{constructor(){super(...arguments),this.state={}}render(){return r.a.createElement(i.d,null,r.a.createElement(i.b,{exact:!0,path:"/product",component:f}),r.a.createElement(i.b,{path:"/product/add",component:j}),r.a.createElement(i.b,{path:"/product/detail",component:z}),r.a.createElement(i.a,{to:"/product"}))}}}}]);